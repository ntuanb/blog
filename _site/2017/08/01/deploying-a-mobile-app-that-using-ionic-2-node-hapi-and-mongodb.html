<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Deploying a Mobile App That Uses Ionic 2, Node, Hapi and MongoDB - Blog</title><link rel="stylesheet" href="/css/main.css"><title>Deploying a Mobile App That Uses Ionic 2, Node, Hapi and MongoDB | Blog</title><meta name="generator" content="Jekyll v3.7.3" /><meta property="og:title" content="Deploying a Mobile App That Uses Ionic 2, Node, Hapi and MongoDB" /><meta property="og:locale" content="en_US" /><meta name="description" content="A very short tutorial to help me remember how to deploy one of the mobile applications I created in my own time for fun." /><meta property="og:description" content="A very short tutorial to help me remember how to deploy one of the mobile applications I created in my own time for fun." /><meta property="og:site_name" content="Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-08-01T00:00:00+10:00" /><script type="application/ld+json"> {"description":"A very short tutorial to help me remember how to deploy one of the mobile applications I created in my own time for fun.","@type":"BlogPosting","url":"/2017/08/01/deploying-a-mobile-app-that-using-ionic-2-node-hapi-and-mongodb.html","headline":"Deploying a Mobile App That Uses Ionic 2, Node, Hapi and MongoDB","dateModified":"2017-08-01T00:00:00+10:00","datePublished":"2017-08-01T00:00:00+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/08/01/deploying-a-mobile-app-that-using-ionic-2-node-hapi-and-mongodb.html"},"@context":"http://schema.org"}</script></head><body style="background-color: rgb(255, 255, 255)"><script async src="/js/theme.min.js"></script><header> <a href="/"><div class="home"></div></a></header><main> <article><h1 class="post-headline">Deploying a Mobile App That Uses Ionic 2, Node, Hapi and MongoDB</h1><p class="meta"><small>August 01, 2017</small></p><p>A very short tutorial to help me remember how to deploy one of the mobile applications I created in my own time for fun.</p><p>The app uses a variety of different libraries and tools, mostly for practice and learning purposes. I don’t plan on any more updates to this app unless required because it is a very simple idea that works as intended.</p><p>The app is called Last Link because it displays what the last person searched using the search form. You can see the app on the Play Store using the following <a href="https://play.google.com/store/apps/details?id=com.ntuanb.lastlink">link</a>.</p><p>Note, if the connection does not work, that might be because I haven’t set up SSL renewing properly yet.</p><h1 id="angular">Angular</h1><ol><li>Run the command <code class="highlighter-rouge">ionic-app-scripts build</code> to build the APK.</li><li>Deploy the APK to the Google Play Store.</li></ol><h1 id="node-and-hapi">Node and Hapi</h1><p>Make sure your Hapi server points to the right chosen port.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">self</span><span class="p">.</span><span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>
<span class="nb">self</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connection</span><span class="p">({</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span> 
    <span class="na">host</span><span class="p">:</span> <span class="s1">'localhost'</span><span class="p">,</span>
    <span class="na">routes</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">cors</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">origin</span><span class="p">:</span> <span class="p">[</span><span class="s1">'*'</span><span class="p">],</span>
            <span class="na">additionalHeaders</span><span class="p">:</span> <span class="p">[</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">'cache-control'</span><span class="p">,</span> <span class="s1">'x-requested-with'</span><span class="p">,</span> <span class="s1">'Access-Control-Allow-Origin'</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure><p>Make sure that your MongoDB connection is set to the right internal url.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'mongodb://localhost/lastLink'</span><span class="p">);</span></code></pre></figure><ol><li>Install Package Manager 2 with the following cmd <code class="highlighter-rouge">npm install pm2 -g</code>.</li><li>Run your application with the following cmd <code class="highlighter-rouge">pm2 start /var/www/index.js</code>.</li><li>Check you app is in a healthy state with <code class="highlighter-rouge">pm2 l</code>.</li></ol><h1 id="mongodb">MongoDB</h1><ol><li>Install Mongod as a service with the following cmd ``.</li><li>Start Mongod with <code class="highlighter-rouge">service mongod start</code>.</li></ol><h1 id="finally">Finally</h1><p>Setup your Nginx install to use a proxy pass configuration that points to the point that we are using, in this case port <code class="highlighter-rouge">3000</code> and include any relavent SSL configurations.</p><figure class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span class="k">server_name</span> <span class="s">...</span>

<span class="s">location</span> <span class="n">/</span> <span class="p">{</span>
    <span class="kn">proxy_pass</span> <span class="s">http://localhost:3000</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$http_host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-NginX-Proxy</span> <span class="s">true</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">...</span></code></pre></figure><p>Restart your server <code class="highlighter-rouge">service nginx restart</code> and test your application’s api endpoints via <code class="highlighter-rouge">https://api.example.com/</code>.</p><h1 id="conclusion">Conclusion</h1><p>I plan on adding in <code class="highlighter-rouge">[Fastlane](https://fastlane.tools/)</code> at some point to this application if there are bugs or any new ideas are to be added in.</p><hr class="divider"><div id="disqus_thread"></div><script defer> (function() { var d = document, s = d.createElement('script'); s.src = '//tuanb-me.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script><noscript>Please enable JavaScript to view the comments</noscript> </article></main><footer><div class="links"> <a href="/contact/">Contact</a> <a class="theme" onclick="theme()">Dark/Light</a></div></footer><script src="https://cdn.jsdelivr.net/npm/ga-lite@1/dist/ga-lite.min.js" async></script><script> var galite = galite || {}; galite.UA = 'UA-90397102-1';</script></body></html>
